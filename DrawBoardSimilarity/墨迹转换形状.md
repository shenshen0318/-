# 墨迹转换技术报告

## 对应产品设计思路

### 两类产品的设计猜想  

- OneNote  

OneNote功能比较简单，尝试几次就可以看的出来，没有明显拐角的一般识别成圆，有$k$个明显拐角就被识别$k$边形  

> - 那他的设计思路肯定是通过判断笔迹间的折线角进行配准的  
> - 和你们先行思路类似，但是不需要考虑顺序问题  
> - 我觉得你们现行方案的改进主要还是在顺序上，顺序这个东西比较鸡肋

- PowerPoint

PPT的设计较为复杂，他的操作是画完墨迹后选中转换对应图形库，这种方法肯定是上网络了。
也就是我提过的第四种解决方案

> - 文字/公式识别 ： OCR转换  
> - 形状识别：检测 + 分类网络  

## 四种执行策略

基础构成：  

素材库json格式：
1、Base64存储绘制出的图片
(绘制到页面上，通过网页位置进行截取，而后resize至64x64大小，以Base64进行存储)

2、提取出的特征值/向量
(同Base64/二进制串)

3、继承素材库的原有属性

### Strategy 1

SIFT角点提取 + 距离匹配算法
这里不展开讲，小豪应该会提这个方法

可能存在问题：控件配准和图片配准不同。首先对于图形来说，特征点是稀疏的，因为并非强纹理状态，SIFT角点依赖梯度(多存在于纹理、边缘信息)。如果你的素材库是线条组成的，可能难以提取到有效角点。
**注意： 这里只是提一个可能性，有待实验验证**  

### Strategy 2

预训练ResNet做卷积，提取一维特征向量。用向量配准库进行搜索  
这个他也会讲，我也不展开说。

我一开始也比较偏向这种，但是我觉得通用的ResNet/Vgg在使用前可以用类似弱监督、无监督的方式进行FineTurning，效果应该会更好一些。

可能存在问题：弱纹理的原因，可能会弱化网络的分辨能力

### Strategy 3

Hash策略，Hash是一种经典的策略搜索策略，在以图搜图中Hash是一种经典的粗排序策略。  
素材库里每一个样例都是一张图片，将其resize至固定大小，转至频域内，生成特征串。  
因为可以捕获控件的最小外边缘，同样的操作获取图片resize后生成特征串

计算墨迹的特征串与素材库内特征串的最小向量距离即可
常见图片 Hash策略有 pHash, wHash, aHash
向量距离： 欧式距离， 汉明距离

示例代码见Strategy3.py

## 总结

### 请注意  

- 需求本身不只是以图搜图和图像配准问题
- 需求需要将用户墨迹转换为对应的控件
- 上述多种策略都是搜索，并不包含转化的步骤。
- 其实都不靠谱

CV领域在这方面能做的有限，确实有生成对抗的思想可以使用，但是需要大量数据集的验证。最靠谱的设计思路决定是像OneNote做的一样  
你通过笔触发生的折角，将每一个笔画均记录成一个特定对象。  
通过对象间的相关性匹配进行转换

举例：
用户绘制了一个歪歪扭扭的线，由于不存在我们定义的折角，我们就认为他是直线。取开始结尾点，生成直线。
如果一条线存在弧度，我们将其记录为曲线

基类：
1、直线
2、曲线
...

派生类：
1、折线
2、圆弧
...

每一个模板库都由多个对象描述而成，按对象进行匹配，如果能正确匹配上，将其按照每一个类的绘图规则进行绘制。如果不能配准，跳过。
